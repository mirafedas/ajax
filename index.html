<!DOCTYPE html>
<html>
<head>
    <title>play with ajax</title>
</head>
<body>
    <div id="images">
        Loading ..
    </div>
    <button onclick="getImages()">Get images</button>
 
    <style type="text/css">
        #images img {
            height: 50px;
            margin: 3px;
        }
    </style>
 
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
 
    <script type="text/javascript">
        var get = function (url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
 
            xhr.onreadystatechange = function () {
                if (xhr.readyState != xhr.DONE) return;
 
                var status = xhr.status;
                var headers = xhr.getAllResponseHeaders();
                var text = xhr.responseText;
 
                callback(status, headers, text);
            }
 
            xhr.send();
        }
 
        var appendImage = function (url) {
            var imgEl = document.createElement('img');
            // <img />
 
            imgEl.src = url;
            // <img src="{url}" />
 
            imgEl.onerror = function () {
                imgEl.style.display = 'none';
                // when image loading failed
                // @todo hide image
                //alert(1);
            }
 
            document.getElementById('images').appendChild(imgEl);
        }
 
        // getImages({limit: 5})
        // getImages({})
        // getImages() -- by default should take 100 images
 
        
        // getImages({category: "cats"})
        // getImages()
 
        // "S"OLID, S -> Single Responsibility
        var getImages = function (params) {
            //
            // var url = 'https://www.reddit.com/r/pics.json';
            var category = 'pics';
            var limit = 100;

            if (params && params.category) {
                category = params.category;
            }
            
            var url = 'https://www.reddit.com/r/pics/search.json?q=' + category;
            
            if (params && params.limit) {
                limit = params.limit;
            }
            url = url + '&limit=' + limit ;         
                    
                    // @todo: use here params.limit
                    // @todo: category == "pics"
 
            get(url, function (status, headers, body) {
                var response = JSON.parse(body);
 
                _.each(response.data.children, function (child) {
                    var url = child.data.url;
 
                    appendImage(url);
 
                    console.log('ITEM!', child.data.url);
                });
 
            });
        }
 
    </script>
    
     <script type="text/javascript">
         $.ajax({
  type:     "GET",
  url:      "http://google.com.ua",
  dataType: "jsonp",
  success: function(data){
    console.log(data);
  }
});
     </script>
    
 
</body>
</html>
